{% extends 'base/base.html' %}

{% block content %}
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
<style>
    #header {
        text-align: center;
    }

    #main {
        border: 1px solid red;
        display: flex;
        /* flex-direction: column; */
        text-align: center;
        width: 100%;
    }

    #row {
        width: 1200px;
        display: flex;
        flex-direction: row;
        margin: 40px auto;
        justify-content: space-between;
    }

    #wordwrap {
        display: flex;
        flex-direction: row;
        margin: 0 auto;
    }

    #westwrap {
        display: flex;
        flex-direction: column;
    }

    #wordcloud {
        border: 1px solid black;
        width: 800px;
        height: 300px;
    }

    #weather {
        border: 1px solid black;
        width: 200px;
        height: 150px;
    }

    #stock {
        border: 1px solid black;
        width: 200px;
        height: 150px;
    }

    #intro {
        border: 1px solid black;
        width: 100px;
        height: 100px;
        margin: 0 auto;
    }
    #index{
        width: 100%;
        height: 1080px;
    }
    #container {
        width: 1200px;
        height: 500px;
        margin: 0 auto;
        margin-top: 40px;
        border: 1px solid black;
        border-radius: 15px;
        padding: 20px;
    }
    #sectioncont{
        visibility: hidden;
        border: 1px solid rgb(80, 80, 80);
        border-radius: 10px;
        position: relative;
    }
    #sectionwrap{
        width: 580px;
        height: 380px;
        display: flex;
        flex-direction: row;
    }
    .section{
        width:528px;
        height: 380px;
        position: relative;
        padding: 4px;
    }
    #menuwrap{
        display: flex;
        flex-direction: row;
    }
    .sectionid{
        width: 116px;
        height: 30px;
        border-left: 1px solid black;
        border-top: 1px solid black;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: 0.5s;
    }
    .slick-prev{
        position: absolute;
        top:50%;
        z-index: 3;
        border: none;
        background-color: #ffffff00;
    }
    .slick-next{
        position: absolute;
        top:50%;
        right: 0;
        z-index: 3;
        border: none;
        background-color: #ffffff00;
    }
    .sectiontag{
        /* position: absolute; */
        margin-top: -4px;
        margin-left: -4px;
        z-index: 3;
        top: 0px;
        left: 0px;
        color: white;
        width: 580px;
        height: 32px;
        background-color: rgba(80, 80, 80);
        font-size: 1em;
        display: flex;
        align-items: center;
        justify-content: center;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
    }

    #btn0{
        border-left: 0px;
        border-bottom-left-radius: 10px;
        background-color: rgba(80, 80, 80); color:white;
    }
    #btn4{
        border-bottom-right-radius: 10px;
    }
</style>
<script>
    $(document).ready(function(){
        document.getElementById('sectioncont').style.visibility='visible';
        sectionBtns = document.querySelectorAll(".sectionid");
        sectionBtns.forEach(function(sectionBtn){
            sectionBtn.addEventListener('click',function(e){
                if (this.id == 'btn0'){
                    $('#sectionwrap').slick('goTo', 0)
                }
                if (this.id == 'btn1'){
                    $('#sectionwrap').slick('goTo', 1)
                }
                if (this.id == 'btn2'){
                    $('#sectionwrap').slick('goTo', 2)
                }
                if (this.id == 'btn3'){
                    $('#sectionwrap').slick('goTo', 3)
                }
                if (this.id == 'btn4'){
                    $('#sectionwrap').slick('goTo', 4)
                }
            });
        });

        $('#sectionwrap').on('beforeChange', function(event, slick, currentSlide, nextSlide){
            document.querySelector("#btn"+currentSlide).style="background-color: rgba(255, 255, 255); color:black;"
            document.querySelector("#btn"+nextSlide).style="background-color: rgba(80, 80, 80); color:white;"
        });

        $(function(){
            $('#sectionwrap').slick({
                slide: 'div',        //슬라이드 되어야 할 태그
                infinite : false,     //무한 반복 옵션     
                slidesToShow : 1,        // 한 화면에 보여질 컨텐츠 개수
                slidesToScroll : 1,        //스크롤 한번에 움직일 컨텐츠 개수
                speed : 500,     // 다음 버튼 누르고 다음 화면 뜨는데까지 걸리는 시간(ms)
                arrows : true,         // 옆으로 이동하는 화살표 표시 여부
                dots : false,         // 스크롤바 아래 점으로 페이지네이션 여부
                autoplay : false,            // 자동 스크롤 사용 여부
                autoplaySpeed : 2000,         // 자동 스크롤 시 다음으로 넘어가는데 걸리는 시간 (ms)
                pauseOnHover : true,        // 슬라이드 이동    시 마우스 호버하면 슬라이더 멈추게 설정
                vertical : false,        // 세로 방향 슬라이드 옵션
                prevArrow : "<button type='button' class='slick-prev'><i class='fa-solid fa-arrow-left' style='color: #808080;'></i></button>",
                nextArrow : "<button type='button' class='slick-next'><i class='fa-solid fa-arrow-right' style='color: #808080;'></button>",
                draggable : true,     //드래그 가능 여부 
            });
        });
    });
</script>
<script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-core.min.js"></script>
<script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-tag-cloud.min.js"></script>
<script type='text/javascript' src='https://www.weatherapi.com/weather/widget.ashx?loc=1377353&wid=4&tu=1&div=weatherapi-weather-widget-4' async></script>

<div id="index">
    <div id="container"></div>
    <div id="row">
        <div style="width:580px;" id="weatherapi-weather-widget-4"></div>
        <div id="sectioncont">
            <div id="sectionwrap">
                <div id="section1" class="section"><div id="tag1" class="sectiontag">정치</div></div>
                <div id="section2" class="section"><div id="tag2" class="sectiontag">경제</div></div>
                <div id="section3" class="section"><div id="tag3" class="sectiontag">사회</div></div>
                <div id="section4" class="section"><div id="tag4" class="sectiontag">세계</div></div>
                <div id="section5" class="section"><div id="tag5" class="sectiontag">IT</div></div>
            </div>
            <div id="menuwrap">
                <div id="btn0" class="sectionid" style="border-left: 0px">정치</div>
                <div id="btn1" class="sectionid">경제</div>
                <div id="btn2" class="sectionid">사회</div>
                <div id="btn3" class="sectionid">세계</div>
                <div id="btn4" class="sectionid">IT</div>
            </div>
        </div>
    </div>
</div>

<script>
    anychart.onDocumentReady(function () {
        var sectionData = [
            { x: "정치섹션", value: 80 },
            { x: "includes", value: 56 },
            { x: "lists", value: 44 },
            { x: "meaning", value: 40 },
            { x: "useful", value: 36 },
            { x: "different", value: 32 },
            { x: "grammar", value: 28 },
            { x: "teaching", value: 24 },
            { x: "example", value: 20 },
            { x: "thing", value: 12 },
            { x: "riding", value: 80 },
            { x: "increse", value: 56 },
            { x: "titles", value: 44 },
            { x: "understand", value: 40 },
            { x: "useless", value: 36 },
            { x: "difficult", value: 32 },
            { x: "verb", value: 28 },
            { x: "studing", value: 24 },
            { x: "test", value: 20 },
            { x: "one", value: 12 },
        ];
        // for(var i=1; i<6; i++){
        //     var sectionChart = anychart.tagCloud(sectionData);
        //     sectionChart.container("section"+i);
        //     sectionChart.draw();
        // }
        // create data   
        var data = [
            { x: "비상경보", value: 80 },
            { x: "includes", value: 56 },
            { x: "lists", value: 44 },
            { x: "meaning", value: 40 },
            { x: "useful", value: 36 },
            { x: "different", value: 32 },
            { x: "grammar", value: 28 },
            { x: "teaching", value: 24 },
            { x: "example", value: 20 },
            { x: "thing", value: 12 },
            { x: "riding", value: 80 },
            { x: "increse", value: 56 },
            { x: "titles", value: 44 },
            { x: "understand", value: 40 },
            { x: "useless", value: 36 },
            { x: "difficult", value: 32 },
            { x: "verb", value: 28 },
            { x: "studing", value: 24 },
            { x: "test", value: 20 },
            { x: "one", value: 12 },
        ];

        var test = []
        let posts = JSON.parse("{{ keywords | escapejs }}")
        let politics = JSON.parse("{{ keywords_politics | escapejs }}")
        let economics = JSON.parse("{{ keywords_economics | escapejs }}")
        let social = JSON.parse("{{ keywords_social | escapejs }}")
        let world = JSON.parse("{{ keywords_world | escapejs }}")
        let IT = JSON.parse("{{ keywords_IT | escapejs }}")
        
        console.log(posts)

        // create a chart and set the data
        var chart = anychart.tagCloud(posts);
        var politics_chart = anychart.tagCloud(politics)
        var economics_chart = anychart.tagCloud(economics)
        var social_chart = anychart.tagCloud(social)
        var world_chart = anychart.tagCloud(world)
        var IT_chart = anychart.tagCloud(IT)

        // set the container id
        chart.container("container");
        politics_chart.container("section1");
        economics_chart.container("section2");
        social_chart.container("section3");
        world_chart.container("section4");
        IT_chart.container("section5");
        
        
        // initiate drawing the chart
        chart.draw();
        politics_chart.draw();
        economics_chart.draw();
        social_chart.draw();
        world_chart.draw();
        IT_chart.draw();

        // title
        // chart.title('test title')

        // configure angles
        // chart.angles([0, 330, 30]);

        // set the mode of the tag cloud
        // chart.mode("spiral"); // or "rect"

        // add an event listener to open a url on click
        console.log(chart)
        chart.listen("pointClick", function (e) {
            var url = "/search/?search=" + e.point.get("x")+"&press=&section=";
            window.location.href = url
        });
        politics_chart.listen("pointClick", function (e) {
            var url = "/search/?search=" + e.point.get("x")+"&press=&section=%5B100%5D";
            window.location.href = url
        });
        economics_chart.listen("pointClick", function (e) {
            var url = "/search/?search=" + e.point.get("x")+"&press=&section=%5B101%5D";
            window.location.href = url
        });
        social_chart.listen("pointClick", function (e) {
            var url = "/search/?search=" + e.point.get("x")+"&press=&section=%5B102%5D";
            window.location.href = url
        });
        world_chart.listen("pointClick", function (e) {
            var url = "/search/?search=" + e.point.get("x")+"&press=&section=%5B104%5D";
            window.location.href = url
        });
        IT_chart.listen("pointClick", function (e) {
            var url = "/search/?search=" + e.point.get("x")+"&press=&section=%5B105%5D";
            window.location.href = url
        });

    });
</script>
{% endblock %}